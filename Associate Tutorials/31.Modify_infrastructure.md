# Modify Infrastructure — Summary Notes

## Overview
In this tutorial, you learn how to **modify existing infrastructure** in **HCP Terraform** using the **CLI-driven workflow**.  
You’ll use per-run variables to change your configuration (e.g., resizing an EC2 instance) and explore the workspace interface in HCP Terraform.

---

## 1️⃣ Explore Your Workspace

### Workspace Overview Page Includes:
- **Lock status** — prevents others from running concurrent changes.  
- **Resource count** — number of managed resources.  
- **Terraform version** — used for that workspace.  
- **Last update time** and the **Lock button**.  
- **New run button** — trigger manual Terraform runs.

### Other Workspace Tabs:
| Tab | Description |
|-----|--------------|
| **Latest run** | Shows plan summary, cost estimates, and resource changes. |
| **Resources & Outputs** | Lists provisioned resources and Terraform outputs. |
| **Sidebar** | Displays metrics, settings, and tags (used for grouping/filtering workspaces). |
| **Runs** | Lists all plans/applies with filters for Status, Operation, and Source. |
| **States** | Contains the history of all successful state snapshots. |
| **Variables** | Displays Terraform variables, environment variables, and variable sets. |
| **Settings** | Workspace-level configuration including destruction options. |

---

## 2️⃣ Edit Variables to Change Infrastructure

Variables make Terraform configurations **flexible** and reusable.  
In HCP Terraform, you can define variables in several ways:

| Variable Source | Persistence | Description |
|------------------|-------------|--------------|
| **Workspace UI (Variables tab)** | Persistent | Saved in workspace for all runs. |
| **CLI per-run (`-var`)** | Temporary | Overrides workspace variables for that run only. |
| **VCS or API** | Persistent | Defined via connected repo or automated pipeline. |

---

### Example: Resize EC2 Instance with CLI Variable
Use the `-var` flag to override your instance type temporarily:

```bash
terraform apply -var="instance_type=t2.small"
```
- Terraform starts a **remote apply** in your workspace.  
- Output streams to your terminal.  
- You can also view the run in the workspace UI.

> Note: This change is **not saved** in the workspace variables — it only affects this run.

---

## 3️⃣ Approve the Run in HCP Terraform

Terraform’s plan output (AWS provider example):
```
# aws_instance.main will be updated in-place
~ instance_type = "t2.micro" -> "t2.small"
```
Click **Confirm & Apply** in the workspace UI or approve via CLI prompt.

HCP Terraform will resize your instance **in place** (no new resource created).

---

## 4️⃣ Best Practices
✅ Use **workspace variables** for consistent, team-wide configurations.  
✅ Use **per-run CLI variables** for temporary or test changes.  
✅ Lock workspaces before major updates to prevent race conditions.  
✅ Track changes via the **Runs tab** (audit trail).  
✅ Understand **variable precedence**:
```
Per-run (-var) > Environment variables > Workspace variables > Defaults in code
```

---

## 5️⃣ Next Steps
- Learn more about **variable precedence** in HCP Terraform documentation.  
- Connect your workspace to a **VCS-driven workflow** to automate runs on pull requests.  
- Continue exploring **Projects**, **Policies**, and **Run Tasks** in HCP Terraform.

---

## ✅ Summary
- Explored the HCP Terraform workspace UI and key features.  
- Modified infrastructure by passing per-run variables from CLI.  
- Applied and approved remote changes securely.  
- Learned best practices for managing variables and controlling workspace state.

---

### References
- [Variables in HCP Terraform](https://developer.hashicorp.com/terraform/cloud-docs/workspaces/variables)
- [HCP Terraform Workspaces](https://developer.hashicorp.com/terraform/cloud-docs/workspaces)
- [CLI-driven Runs](https://developer.hashicorp.com/terraform/tutorials/cloud/cli-driven-workflow)
