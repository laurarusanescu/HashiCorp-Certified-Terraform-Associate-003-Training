# Summary Notes: Provision an AWS EC2 Instance with Terraform

## Overview
Use **Terraform** to create and manage cloud infrastructure as code. This tutorial shows how to provision an **AWS EC2** instance (VM) in **us-west-2** using provider configuration, environment credentials, and the standard Terraform workflow (**init → validate → plan → apply**), then inspect **state**.

---

## Prerequisites
- **Terraform CLI** ≥ 1.2.0
- **AWS CLI**
- **AWS account** with permissions to create EC2, VPC, and security groups in **us-west-2**
- (Optional) Use AWS Free Tier; remember to **destroy** resources to avoid charges.

---

## Project Setup
```bash
mkdir learn-terraform-get-started-aws
cd learn-terraform-get-started-aws
```

### `terraform.tf` (Terraform & provider requirements)
```hcl
terraform {
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> 5.92"
    }
  }
  required_version = ">= 1.2"
}
```

### `main.tf` (Provider, data, and resource)
```hcl
provider "aws" {
  region = "us-west-2"
}

data "aws_ami" "ubuntu" {
  most_recent = true
  filter {
    name   = "name"
    values = ["ubuntu/images/hvm-ssd-gp3/ubuntu-noble-24.04-amd64-server-*"]
  }
  owners = ["099720109477"] # Canonical
}

resource "aws_instance" "app_server" {
  ami           = data.aws_ami.ubuntu.id
  instance_type = "t2.micro" # free tier eligible
  tags = { Name = "learn-terraform" }
}
```

> **Notes**
> - Use a different `region` if preferred.
> - The **data source** dynamically finds a current Ubuntu AMI so you don’t hardcode AMI IDs.
> - The **resource** creates one EC2 instance and tags it.

---

## Credentials
Export IAM user credentials (or use another supported auth method):
```bash
export AWS_ACCESS_KEY_ID=...
export AWS_SECRET_ACCESS_KEY=...
```
Verify with:
```bash
aws configure list
```

---

## Commands & Workflow
1) **Format**
```bash
terraform fmt
```
2) **Initialize** (downloads providers and creates `.terraform.lock.hcl`)
```bash
terraform init
```
3) **Validate**
```bash
terraform validate
```
4) **Plan + Apply**
```bash
terraform apply
# review plan, then type: yes
```
Output shows a plan with `+ create` for `aws_instance.app_server`, then instance creation progress and final ID.

---

## Inspect State
- List tracked items:
```bash
terraform state list
```
- Show full state details:
```bash
terraform show
```
**State** records real-world resources and data; it’s required for planning and drift detection and may contain **sensitive information**. Store it **securely** (consider **remote state** via HCP Terraform for collaboration and access control).

---

## Key Concepts Recap
- **Providers**: plugins that call cloud APIs; versioned independently of Terraform.
- **Data sources**: read-only lookups (e.g., latest Ubuntu AMI).
- **Resources**: managed infrastructure (e.g., `aws_instance`). Addressed by `type.name`.
- **Lock file** (`.terraform.lock.hcl`): pins provider versions for reproducibility.
- **Workflow**: `init` → `validate` → `plan` → `apply` → (optional) `destroy`.

---

## Clean Up
Destroy to avoid charges:
```bash
terraform destroy
# confirm: yes
```

---

## Troubleshooting Tips
- If `validate` fails: check typos, unsupported arguments, or provider version mismatches.
- If AMI lookup fails: confirm region and data source filter matches available AMIs.
- If apply fails on permissions: verify IAM policy allows EC2/VPC/SG operations.

