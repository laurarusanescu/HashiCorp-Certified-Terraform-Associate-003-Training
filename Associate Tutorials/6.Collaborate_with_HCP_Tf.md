# Summary Notes: Migrate Local Terraform to HCP Terraform (CLI‑Driven Workflow)

## Why HCP Terraform?
- **Collaboration & governance:** Shared workspaces, projects, permissions.
- **Secure remote execution:** Plans & applies run in HCP Terraform; logs stream to your terminal.
- **Remote state & variables:** Central, encrypted storage for state, env vars, and sensitive values (API tokens, keys).
- **Multiple workflows:** **CLI‑driven**, **VCS‑driven** (runs on git pushes/PRs), and **API‑driven**.

---

## Prerequisites
- Terraform CLI ≥ **1.2.0**
- AWS CLI
- AWS credentials with permissions in **us‑west‑2**
- Existing config from prior tutorials (VPC module + EC2 instance, etc.)

---

## 1) Recreate Local Resources (if you destroyed them)
```bash
terraform apply
# confirm: yes
```
Creates the VPC/networking (and later EC2) locally so you can migrate state.

---

## 2) Sign Up & Log In to HCP Terraform
1. Create an HCP Terraform account and **organization**.
2. CLI login:
   ```bash
   terraform login
   ```
   - Approve opening the browser, generate API token, paste it back to CLI.
   - Token is stored at `~/.terraform.d/credentials.tfrc.json`.

---

## 3) Connect Your Workspace (add `cloud` block)
Edit **`terraform.tf`**:
```hcl
terraform {
  cloud {
    organization = "your-organization-name"
    workspaces {
      project = "Learn Terraform"
      name    = "learn-terraform-aws-get-started"
    }
  }

  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> 5.92"
    }
  }

  required_version = ">= 1.2.0"
}
```
> HCP Terraform will create the **project** and **workspace** if missing.

Re‑init and **migrate state** when prompted:
```bash
terraform init
# Answer "yes" to copy existing local state to HCP Terraform
```

---

## 4) Configure Workspace Variables (AWS creds)
In the HCP Terraform UI → **Workspace → Variables**:
- Add `AWS_ACCESS_KEY_ID` and `AWS_SECRET_ACCESS_KEY` as **Environment Variables**.
- Mark them **Sensitive**.

---

## 5) Apply via HCP Terraform (CLI‑Driven)
Uncomment resources/outputs if previously commented:

**`main.tf`**
```hcl
resource "aws_instance" "app_server" {
  ami           = data.aws_ami.ubuntu.id
  instance_type = var.instance_type

  vpc_security_group_ids = [module.vpc.default_security_group_id]
  subnet_id              = module.vpc.private_subnets[0]

  tags = { Name = var.instance_name }
}
```

**`outputs.tf`**
```hcl
output "instance_hostname" {
  description = "Private DNS name of the EC2 instance."
  value       = aws_instance.app_server.private_dns
}
```

Run:
```bash
terraform apply
# A remote run is prepared; URL is shown; approve with "yes"
```
- Plan & apply execute **remotely**.
- Output (including `instance_hostname`) streams to your terminal.
- State is stored **remotely**.

---

## 6) Destroy via HCP Terraform
```bash
terraform destroy
# Remote plan/apply runs; approve with "yes"
```
- Tears down all resources (e.g., EC2, subnets, gateways, VPC) in **dependency order**.
- Afterwards, delete the **workspace** (Settings → Destruction & Deletion) and optionally the **project**.

---

## Workflow Choices Recap
- **CLI‑Driven:** You run `plan/apply/destroy`; HCP executes remotely.
- **VCS‑Driven:** Connect a repo; runs on commits/PRs with policy checks.
- **API‑Driven:** Full automation via Terraform Cloud API.

---

## Good Practices
- Use **projects** to group workspaces by team/app/env.
- Keep provider and TF **versions pinned**; commit `.terraform.lock.hcl`.
- Store **sensitive variables** only in HCP Terraform.
- Use **workspaces** per environment (e.g., dev/stage/prod).
- Always review **remote plan** before approving.

---

## Command Reference
```bash
terraform login              # authenticate CLI with HCP Terraform
terraform init               # set up cloud backend; migrate state
terraform plan               # remote plan
terraform apply              # remote apply
terraform destroy            # remote destroy
```

---

## Next Steps
- Try the **VCS‑driven** getting started labs.
- Explore **teams & access**, **run tasks**, **policies**, and **state versions**.
